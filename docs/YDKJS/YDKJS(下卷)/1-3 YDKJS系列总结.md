# 深入“你不知道的JavaScript系列”

简单地说，《你不知道的JavaScript系列》这个系列视学习**全部的 JavaScript** 为一个严肃的任务，不仅仅是这门语言中被称为“精髓”的某个子集，也不是你完成工作所需要的最小集合。

## 作用域与闭包

变量的作用域到底是如何在 JavaScript 中工作的？这可能是你需要快速理解的一个最基础的事情了。

“作用域和闭包”这部分从批判 JavaScript 是“解释性语言”因而无法编译这一常见误解开始。事实并非如此。

JavaScript 引擎在执行前(有时是执行中)就编译了代码。因此，通过深入理解编译器对代码的处理方式，我们可以尝试理解它是如何找到并处理变量和函数声明的。沿着这条路，我们看到了 **JavaScript 变量作用域管理的常见方式——“提升”**。

**对“词法作用域”的关键理解是研究闭包的基础**。闭包可能是 JavaScript 所有概念中最重要的一个，但如果你没有深刻了解作用域的工作原理， 那么很可能就无法理解闭包。

正如我们在第 2 章中简单提到的那样，闭包的一个重要应用就是**模块模式**。模块模式可能是 JavaScript 所有代码组织模式中最普遍的方法。**深入理解模块模式应该是你最高优先级的任务之一**。

## this 和对象原型

有关 JavaScript 流传最广、最持久的不实论点是，关键词 this 指向它所在的函数。这简直错得离谱。

**关键词 this 是根据相关函数的执行方式而动态绑定的**。事实证明，可以通过 4 条简单的规则理解并完全确定 this 绑定。

* 由new调用?绑定到新创建的对象。
* 由call或者apply(或者bind)调用?绑定到指定的对象。
* 由上下文对象调用?绑定到那个上下文对象。
* 默认:在严格模式下绑定到undefined，否则绑定到全局对象。

与 this 紧密关联的是对象原型机制，这种机制是一个**属性查找链**，与寻找词法作用域变量的方式类似。但在原型中进行封装，即模拟类和继承，是**对 JavaScript 的另一个重大误用**。

不幸的是，将类和继承的设计模式思维带入 JavaScript 的想法是你所做的最坏的事情，因为语法可能会让你迷惑不已，让你以为真的有类这样的东西存在，**实际上原型机制与类的行为特性是完全相反的**。

对象原型系统真实的工作方式可以被更合理地命名为“行为委托”。

这不只是语法偏好的问题。**委托是完全不同的设计模式，也更加强大，它取代了需要类和继承的设计**。

## 类型和语法

“类型和语法”这部分主要关注另一个高度争议的主题:强制类型转换。

类型转换是非常有用且被低估了的工具，你应该在自己的代码中使用它。在我看来，如果能够正确使用的话，类型转换不仅能够工作，而且也会让你的代码质量更高。

## 异步和性能

*作用域和闭包* *this 和 对象原型* 以及 *类型和语法* 关注的都是**语言的核心机制**，而 *异步和性能* 则稍微偏重于**在语言机制之上处理异步编程的模式**。异步不只是对应用的性能至关重要，而且正在慢慢成为代码易写性和可维护性方面的关键因素。

*异步* 和 *性能* 部分一开始明确了大量的术语和概念，如 *异步* *并行* 和 *并发* 这些概念，并深入解释了这些概念为什么适用或不适用于 JavaScript。

然后我们查看了回调这个使得异步成为可能的基本方法。但我们很快就看到，单独使用回调完全不足以满足当代异步编程的需求。我们确定了两种只用回调编码的缺陷:控制反转 (Inversion of Control，IoC)信任缺失和线性理解能力的缺失。

为了避免这两个主要的缺陷，ES6 引入了新的机制(实际上是模式):promise 和生成器。

promise 是对“未来值”的与时间无关的封装，使得不管这个值是否已经可用，你都可以推导和组合使用它们。另外，通过一种可信任的、可组合的 promise 机制，分发回调它们也有效地解决了 IoC 信任问题。

生成器为 JavaScript 函数引入了一种新的执行模式，其中生成器可以暂停在 yield 点上， 并在之后被异步继续。暂停与继续的能力使得生成器中同步的、看似连续的代码可以在后台异步执行。通过这种方式，我们解决了回调的非线性、非局部跳转引发的代码混乱问题，因而让我们的异步代码看似同步，更容易追踪。

但是，promise 和生成器的组合“暂缓”了我们最有效的异步编码模式进入 JavaScript 的日程。实际上，ES7 及更新版本中即将出现的异步的高级机制很大程度上是建立在这个基础上的。要想在异步的世界中严肃地对待程序效率，你需要非常熟悉 promise 和生成器的组合。

如果说 promise 和生成器与表达模式有关，这种模式使得我们的程序可以更加并发地运行， 因此能在更短的时间内处理完毕，那么 JavaScript 还有很多其他的性能优化因素值得探讨。

第 5 章探讨了通过 Web Worker 实现程序并行和通过 SIMD 实现数据并行的主题，以及像 ASM.js 这样的底层优化技术。第 6 章从合适的测评技术角度介绍了性能优化，其中包括哪些类型的性能需要关注，哪些可以忽略。

编写高效的 JavaScript 代码意味着，你编写的代码可以打破不同浏览器和环境的壁垒，达到动态运行。这要求大量复杂而详细的计划和努力，只有这样，才能让程序从“可以运行”到“可以很好地运行”。

“异步和性能”部分的目的是，为你提供编写合理、高性能 JavaScript 代码所需要的所有工具和技巧。

## ES6 及更新版本

参考本书第二部分。

预先列出令人兴奋的 ES6 特性:解构、默认参数值、符号、简洁方法、计算属性、箭头函 数、块作用域、promise、生成器、迭代器、模块、代理、WeakMap、...