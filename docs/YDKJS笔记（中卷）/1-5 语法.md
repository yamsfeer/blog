## 语法

:::info

语法(grammar)是本部分讨论的最后一个重点。

:::

### 语句与表达式

开发人员常常将`“语句”(statement)`和`“表达式”(expression)`混为一谈，其实它们在 JavaScript 中存在一些重要差别。

> 英语的语法：
>
> 句子”(sentence)是完整表达某个意思的一组词，由一个或多个“短语”(phrase)组成， 由标点符号或连接词(and 和 or 等)连接。
>
> 短语可以由更小的短语组成。有些短语是不完整的，不能独立表达意思；有些短语则相对完整，并且能够独立表达某个意思。

**JavaScript 的语法也是如此，语句相当于句子，表达式相当于短语，运算符则相当于标点符号和连接词。**

JavaScript 中表达式可以返回一个结果值。例如:

```javascript
var a = 3 * 6;
var b = a;
b;
```

`3 * 6` 是一个表达式(结果为18)。

第二行的 `a`，第三行的 `b` 都是表达式，且结果值都是 18。

`var a = 3 * 6` 和 `var b = a` 称为“声明语句” (declaration statement)，因为它们声明了变量(还可以为其赋值)。

`a = 3 * 6` 和 `b = a` 叫作“赋值表达式”。

第三行代码中只有一个表达式 `b`，同时它也是一个语句(虽然没有太大意义)。这样的情况通常叫作“表达式语句”(expression statement)。

#### 语句的结果值

**语句都有一个结果值(statement completion value，undefined 也算)。**

获得结果值最直接的方法是**在浏览器开发控制台中输入语句**，默认情况下控制台会显示所执行的最后一条语句的结果值。

```javascript
var foo = 20; // 语句结果值为undefined
foo = 10 + 10; // 加法表达式结果值和整个语句结果值都为20
```

代码块 { .. } 的结果值是其最后一个语句 / 表达式的结果，比如：

```javascript
var b;
if (true) {
  b = 1 + 1;
} // 结果值为2
```

一般来说，我们在代码中是没有办法获得语句的结果值的，但还是有两个方法可以获得：

* eval函数（不建议使用）

  ```javascript
  var b;
  var a = eval( "if (true) { b = 1; }" );
  a; // 1
  ```

* ES7的“do表达式”

  ```javascript
  var a, b;
  a = do {
    if (true) {
      b = 4 + 38;
    }
  };
  a; // 42
  ```

  其目的是将语句当作表达式来处理(语句中可以包含其他语句)，从而不需要将语句封装为函数再调用 return 来返回值。

  虽然目前语句的结果值还无关紧要，但随着 JavaScript 语言的演进，它可能会扮演越来越重要的角色。

#### 表达式的副作用

首先说明什么是表达式的副作用，参考以下代码：

```javascript
var a = 2;
var b = a + 3; // 加法表达式 a + 3 本身没有副作用(比如改变a的值)

// 最常见的有副作用(也可能没有)的表达式是函数调用
function foo() {
  a = a + 1;
}
var a = 1;
foo(); // 结果值：undefined，副作用：a的值被改变。

// 递增运算符 ++ 和递减运算符 -- 会有副作用
var a = 42;
a++; // 42
++a; // 44
```

多个赋值语句串联时(链式赋值，chained assignment)，赋值表达式和语句的结果值就能派上用场，比如：

```javascript
var a, b, c;
a = b = c = 42;
```

* `c = 42` 的结果值为42，副作用是将c赋值42
* `b = c` 的结果值为42，副作用是将 b 赋值 42
* `a = b` 的结果值为42，副作用是将 a 赋值 42。

利用赋值表达式的副作用合并if条件：

```javascript
var str, matches;

// 一般写法
if (str) {
  matches = str.match( /[aeiou]/g );
  if (matches) {
    return matches;
  }
}

// 合并，将 matches = str.match 放到括号中是必要的，参考运算符优先级
if (str && (matches = str.match( /[aeiou]/g ))) {
  return matches;
}
```

#### 上下文规则

在 JavaScript 语法规则中，有时候同样的语法在不同的情况下会有不同的解释。

这里以 `{...}` 为例，总结它可能出现的情况（即解释当出现 `{}` 时，JavaScript的语法怎么解读）。

* 对象字面量：`var obj = {...}`
* 代码块：`{ let a = 0 }`

* 对象解构:  `var { a, b } = { a: 1, b: 2}`
* `if - else` 语句： `if (true) { ... }`

### 运算符优先级

### 自动分号

### 错误

### 函数参数

### `try / catch`

### `switch`

### 小结

* 语句就像英语中的句子，表达式就像短语。表达式可以是简单独立的，否则可能会产生副作用。

* JavaScript语法规则之上是语义规则(也称作上下文)。

  例如，`{ }`在不同情况下，可以是语句块、对象常量、解构赋值或者命名函数参数解构。

* JavaScript 详细定义了运算符的优先级(运算符执行的先后顺序)和关联(多个运算符的 组合方式)。

  只要熟练掌握了这些规则，就能对如何合理地运用它们作出自己的判断。

* ASI(自动分号插入)是 JavaScript 引擎的代码解析纠错机制，它会在需要的地方自动插入分号来纠正解析错误。

* JavaScript 中有很多错误类型，分为两大类：

  * 早期错误(编译时错误，无法被捕获)
  * 运行时错误(可以通过 try..catch 来捕获)。

  所有语法错误都是早期错误，程序有语法错误则无法运行。

* 尽量不要使用 arguments
* finally 中代码的处理顺序需要特别注意。
* switch相对于if..else if..来说更为简洁。需要注意的一点是，如果对其理解得不够透彻，稍不注意就很容易出错。