# 背包问题

一个旅行者有一个背包，及$n$种物品，每种物品的重量为$w_i$价值为$v_i$，背包最大重量为$b$，每种物品可放多个。

假设$w_i,v_i,b$都是正整数，**如何选择物品使得背包价值最大**？

来看个具体例子：

$n = 4, b = 10$（4种物品，背包最大重量10）

物品1：$v_1=1,w_1=2$

物品2：$v_2=3,w_2=3$

物品3：$v_3=5,w_3=4$

物品4：$v_4=9,w_4=7$

## 问题建模

**解**：$<x_1,x_2, \dots ,x_n>$（$x_i$是装入背包的第$i$种物品的个数）

**目标函数**：$max \displaystyle \sum ^n _{i=1} {v_ix_i}$（背包价值最大）

**约束条件**：$\displaystyle \sum ^n _{i=1} {w_ix_i \le b}, x_i \in N$（不能超出背包最大重量）

### 子问题界定和计算顺序

* 子问题界定：由参数$k$和$y$界定，其中

  $k$：考虑对物品$1,2,3, \dots ,k$的选择

  $y$：背包总重量不超过$y$

* 子问题计算顺序

  令$k = 1,2,\dots,n$

  对于给定的$k$，令$y=1,2,\dots,b$

### 优化函数的递推方程

考虑装前$k$种物品，总重量不超过$y$，设此时背包能达到的最大价值为$F_k(y)$，有递推方程：
$$
F_k(y)=max\{F_{k-1}(y), \ F_k(y-w_k) + v_k \}
$$
当$y < 0$时，有$F_k(y) = -\infty$。

将$k$值代入，可得：
$$
F_0(y) = 0, 0 \le y \le b, F_k(0) = 0, 0 \le k \le n
$$

$$
F_1(y)= \displaystyle \lfloor \displaystyle \frac {y} {w_i}  \displaystyle\rfloor v_i
$$

### 标记函数

$i_k(y)$：装前$k$种物品，总重不超过$y$，背包达到最大价值时装入物品的最大标号。

$F_k(y-w_k)+v_k$：装入第$k$件物品后背包的最大价值。

当装入前$k-1$件物品的最大价值大于装入第$k$件物品时，最大标号取$i_{k-1}(y)$，否则取$k$。
$$
i_k(y)=\displaystyle \Big\{ ^{i_{k-1}(y) \qquad F_{k-1}(y) > F_k(y-w_k) + v_k} _{k \qquad \qquad F_{k-1}(y) \le F_k(y-w_k)+v_k}
$$

$$
i_1(y)=\Big\{^{0 \qquad y < w_1}_{1 \qquad y \ge w_1}
$$

## 计算过程

针对实例：$n = 4, b = 10$

物品1：$v_1=1,w_1=2$

物品2：$v_2=3,w_2=3$

物品3：$v_3=5,w_3=4$

物品4：$v_4=9,w_4=7$

$F_k(y)$的计算结果如下表：

| $k \downarrow \quad y \rightarrow$ |  1   |  2   |  3   |  4   |  5   |  6   |  7   |  8   |  9   |               10                |
| :--------------------------------: | :--: | :--: | :--: | :--: | :--: | :--: | :--: | :--: | :--: | :-----------------------------: |
|                 1                  |  0   |  1   |  1   |  2   |  2   |  3   |  3   |  4   |  4   |                5                |
|                 2                  |  0   |  1   |  3   |  3   |  4   |  6   |  6   |  7   |  9   |                9                |
|                 3                  |  0   |  1   |  3   |  5   |  5   |  6   |  8   |  10  |  10  |               11                |
|                 4                  |  0   |  1   |  3   |  5   |  5   |  6   |  9   |  10  |  10  | <font color="red">**12**</font> |

由上表可知，最优解中，背包能达到最大的价值为12。

$i_k(y)$的计算如下表：

| $k \downarrow \quad y \rightarrow$ |               1                |  2   |               3                |  4   |  5   |  6   |  7   |  8   |  9   |               10               |
| :--------------------------------: | :----------------------------: | :--: | :----------------------------: | :--: | :--: | :--: | :--: | :--: | :--: | :----------------------------: |
|                 1                  |               0                |  1   |               1                |  1   |  1   |  1   |  1   |  1   |  1   |               1                |
|                 2                  | <font color="red">**0**</font> |  1   |               2                |  2   |  2   |  2   |  2   |  2   |  2   |               2                |
|                 3                  |               0                |  1   |               2                |  3   |  3   |  3   |  3   |  3   |  3   |               3                |
|                 4                  |               0                |  1   | <font color="red">**2**</font> |  3   |  3   |  3   |  4   |  3   |  4   | <font color="red">**4**</font> |

$i_4(10)=4 \Rightarrow x_4 \ge 1$

$i_4(10-w_4)=i_4(3)=2 \Rightarrow x_2 \ge 1,x_4=1,x_3=0$

$i_(3-w_2)=i_2(0)=0 \Rightarrow x_2=1,x_1=0$

综上可得解：$x_1=0,x_2=1,x_3=0,x_4=1$，最大价值**12**

## 时间复杂度

时间复杂度O(nb)。

### 背包问题的推广

* **0-1背包问题**：$x_i=0,1, i=1,2,\dots,n$
* **多背包问题**：$m$个背包，背包$j$最大重量为$B_j,j=1,2,\dots,m$，在满足所有背包的约束条件下使得物品价值最大。
* **二维背包**：每件物品有重量$w_i$和体积$t_i,i=1,2,\dots,n$，背包重量不超过$b$，体积不超过$V$，使物品价值最大。