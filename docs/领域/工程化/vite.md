# vite 特性

vite 在官方文档 [为什么选 vite](https://cn.vitejs.dev/guide/why.html) 一文中解释了 vite 的相关特性。它很好地解决了 webpack 在开发过程中的性能问题。

## webpack 的开发问题

webpack 开发时的问题主要有两个：

* 开发服务器启动慢
* 热更新慢

 webpack 在项目启动阶段，会从入口文件开始，找出所有依赖关系并构建依赖树，然后将所有依赖打包到一起，最后启动开发服务器。

这个操作非常耗时，而且当文件内容发生改变，webpack 需要重新打包一次，即使使用 HMR，更新时间也需要数秒( 原因未知 )。

## vite 特性

vite 将应用中的模块区分为 **依赖** 和 **源码** 两类。

* 依赖通常存放在 `node_modules` 中
  * 浏览器无法直接访问 `node_modules` ：路径解析
  * 它们可以能有 ESM、CommonJS 等各种模块化格式：依赖预构建
  * 单个模块可能导入了多个文件，比如 `lodash-es` ：依赖预构建
* 源码则是经常改变的
  * 并不是所有的源码都需要同时被加载（例如基于路由拆分的代码模块）

### 预构建

(1) 将用CommonJS和UMD写的模块转成ES module

(2) 转换`bare module`路径

(3) 依赖合并为单个模块，减少HTTP请求

(4) 第三方包会在本地`node_modules/.vite`，除非依赖发生变化，才会重新进行预构建。因此后续冷启动会非常快。此外还会在浏览器中进行强缓存，因此页面刷新也会快。

转换工作是在发生模块请求的时候才提供，即按需动态编译