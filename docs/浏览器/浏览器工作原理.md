# 浏览器工作原理

## 简介

网络浏览器很可能是使用最广的软件。在这篇入门文章中，我们会了解到，从地址栏输入 google.com 直到在浏览器屏幕上看到 Google 首页的整个过程中都发生了什么。

### 我们要讨论的浏览器

目前主流的浏览器有5个：Internet Explorer、Firefox、Safari、Chrome 和 Opera。本文中以开放源代码的浏览器为例，即 Firefox、Chrome。

### 浏览器的主要功能

浏览器的主要功能是展示指定位置的资源。资源一般是 HTML 文档，也可以是 PDF、图片或其他。资源的位置由 URI（统一资源标识符）指定。

浏览器解释并显示 HTML 文件的方式是在 HTML 和 CSS 规范中指定的。这些规范由标准化组织 W3C 维护。

浏览器的用户界面有很多彼此相同的元素，包括：

* 输入 URI 的地址栏
* 前进、后退按钮
* 书签选项
* 刷新、停止按钮
* 返回主页按钮

需要说明的是，浏览器的用户界面没有任何正式的规范，以上是多年来的最佳实践发展和彼此互相模仿的结果。

HTML5 也没有定义浏览器必须具有的用户界面元素，但列出了一些通用元素，比如地址栏、状态栏、工具栏等。

### 浏览器的高层结构

浏览器的主要组件为：

* 用户界面：包括地址栏、前进后退按钮、书签菜单等。除了浏览器主窗口显示请求的页面外，其他部分都属于用户界面。
* 浏览器引擎：在用户界面和渲染引擎之间传送指令。

* 渲染引擎：负责显示请求的内容。如果是 HTML，它就负责解析 HTML 和 CSS，并将解析后的内容显示在主窗口。
* JavaScript 解释器：解析和执行 JavaScript 代码。
* 网络：用于网络调用，比如 HTTP 请求。其接口与平台无关，并为所有平台提供底层实现。
* 用户界面后端：用于绘制基本的窗口小部件，比如组合框。其公开了与平台无关的通用接口，在底层使用操作系统的用户界面方法。
* 数据存储：这是持久层。浏览器需要在硬盘上保存各种数据，比如 Cookie。HTML5 规范定义了 IndexedDB，这是一个完整但轻便的浏览器内数据库。

![img](https://tva1.sinaimg.cn/large/008i3skNgy1gvcbi6u94qj60dw09f0t702.jpg)

值得注意的是，和大多数浏览器不同，Chrome 浏览器的每个标签页都分别对应一个渲染引擎实例。每个标签页都是一个独立的进程。

## 渲染引擎

渲染引擎的作用就是在浏览器屏幕上显示请求的内容。

默认情况下，渲染引擎可显示 HTML 和 XML 文档与图片。通过插件（或浏览器扩展程序），还可以显示其他类型的内容；例如，使用 PDF 查看器插件就能显示 PDF 文档。但是在本章中，我们将集中介绍其主要用途：显示使用 CSS 格式化的 HTML 内容和图片。

### 渲染引擎

### 主流程

### 主流程示例

## 解析和DOM树构建

### 解析 - 综述

### HTML解析器

### CSS解析

### 处理脚本和样式表的顺序

## 呈现树构建

### 呈现树和DOM树的关系

### 构建呈现树的流程

### 样式计算

### 渐进式处理

## 布局

## 绘制

## 动态变化

## 呈现引擎的线程

## CSS2可视化模型

## 参考